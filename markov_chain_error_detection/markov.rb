# Generate the Markov Chain
#  make a hash with each letter of the alphabet as a key
#  each key points to another hash, also with each letter of the alphabet as a key
#  when working through the word list, for each letter in the current word, look at the next letter
#   find the current letter's hash in the hash, then increment the count for the next letter
#   do this for each word in the word list
# Using the Markov Chain
#  for each word, split it into its letters, look at each letter and its succeeding letter
#  if the letter is succeeded by a letter for which the count is 0, assign a certain number of
#    points to the word
#    do this for all the letters in the word--if the word's points are above a certain 
#      threshold, surround it with asterisks
# Example Usage
#  markov("wqrld") #=> **wqrld**

class SpellChecker

	attr_reader :markov_hash, :word_list, :totals_hash

	MARKOV = {"a"=>{"a"=>0.06479408943267305, "b"=>18.771674296018865, "c"=>10.592579896224503, "d"=>8.382264378199338, "e"=>0.49946347777028, "f"=>5.17713990173261, "g"=>8.745049971714124, "h"=>1.400268544652399, "i"=>2.297420526922234, "j"=>4.965959150981178, "k"=>9.54241490720565, "l"=>18.891965430855716, "m"=>10.844618114038044, "n"=>13.818022861075715, "o"=>0.09948230567145726, "p"=>9.464467610151491, "q"=>4.812623274161735, "r"=>11.755701821521507, "s"=>5.645253022689407, "t"=>18.432810936978996, "u"=>4.26324099884988, "v"=>10.75310811690425, "w"=>9.162460432885618, "x"=>11.908893709327549, "y"=>5.351640207512579, "z"=>9.473259876377318}, 
						"b"=>{"a"=>3.2489607701240346, "b"=>3.3083645443196, "c"=>0.2025647817754024, "d"=>0.26159289370671485, "e"=>2.1969755633483414, "f"=>0.2534264287561417, "g"=>0.06364322081840468, "h"=>0.15619433864028717, "i"=>3.0198709203113183, "j"=>5.00600720865038, "k"=>0.09016455030430535, "l"=>6.065182734606302, "m"=>0.19986974780480138, "n"=>0.06417470400580362, "o"=>3.436485859990728, "p"=>0.11269803428620967, "q"=>0.0, "r"=>2.2762265781867623, "s"=>0.5861374478933176, "t"=>0.2029247844519602, "u"=>4.278835844753309, "v"=>0.43611273839744846, "w"=>0.3593121738386517, "x"=>0.0, "y"=>0.9439481998673792, "z"=>0.040311744154797095}, 
						"c"=>{"a"=>7.755936653259059, "b"=>0.013871549452073797, "c"=>1.5005375757670194, "d"=>0.056458897922312554, "e"=>3.3679215018197506, "f"=>0.0, "g"=>0.0, "h"=>21.43150741238046, "i"=>3.714045368753667, "j"=>0.0, "k"=>29.333533699000675, "l"=>2.923513970297386, "m"=>0.022457275034247343, "n"=>0.04743347687385485, "o"=>10.51228558182661, "p"=>0.004334539780238834, "q"=>3.4714003944773175, "r"=>3.397232151700417, "s"=>0.5158812469472007, "t"=>4.471966846091554, "u"=>6.327608725316283, "v"=>0.0, "w"=>0.017110103516126275, "x"=>0.0, "y"=>4.395990170456762, "z"=>0.28218220908357966}, 
						"d"=>{"a"=>2.29051313552904, "b"=>0.787210431405188, "c"=>0.17607554108169593, "d"=>1.8217404396266186, "e"=>5.837583105634037, "f"=>0.8068269976726143, "g"=>1.3530077314727513, "h"=>0.5370893047981805, "i"=>6.014293490170575, "j"=>4.845814977973569, "k"=>0.08265083777894658, "l"=>1.6697232310882568, "m"=>0.617575063441802, "n"=>0.5831527450962155, "o"=>3.05980528511822, "p"=>0.26223965670444943, "q"=>0.3155818540433925, "r"=>1.8269239426981567, "s"=>1.8186319444909103, "t"=>0.06287810222455104, "u"=>3.1852472757753563, "v"=>1.1911735989064636, "w"=>2.241423560612542, "x"=>0.0, "y"=>2.414479073214495, "z"=>0.36280569739317386}, 
						"e"=>{"a"=>5.683367273094465, "b"=>4.421556387848523, "c"=>9.551708556024744, "d"=>32.027250828063835, "e"=>2.144982687478567, "f"=>10.13188518231187, "g"=>4.775598717706958, "h"=>1.7208779765982518, "i"=>1.2483829693983586, "j"=>6.888265919102923, "k"=>2.3743331580133744, "l"=>9.609598810936507, "m"=>11.163511419524355, "n"=>15.790697458123681, "o"=>1.7047210632050687, "p"=>7.676469950802973, "q"=>16.80473372781065, "r"=>29.0732120186204, "s"=>25.69637277271115, "t"=>7.420568761015576, "u"=>2.4659350084796974, "v"=>10.779144698301113, "w"=>10.753700059885363, "x"=>53.86117136659436, "y"=>3.4754456449662596, "z"=>2.7680730986294004}, 
						"f"=>{"a"=>1.550850737979434, "b"=>0.09016507143847968, "c"=>0.01558190629041557, "d"=>0.022583559168925023, "e"=>1.3578990453223005, "f"=>8.590638738039825, "g"=>0.009428625306430322, "h"=>0.06302578576713341, "i"=>2.5978524419812956, "j"=>0.16019223067681218, "k"=>0.0075137125253587796, "l"=>2.5639181559926643, "m"=>0.026948730041096814, "n"=>0.022321636175931695, "o"=>2.310307525884716, "p"=>0.028174508571552417, "q"=>0.0, "r"=>1.2128469939942914, "s"=>0.20742306945996403, "t"=>0.6402134044681561, "u"=>3.770053997153941, "v"=>0.0, "w"=>0.0684404140645051, "x"=>0.0, "y"=>1.6538596559659866, "z"=>0.0}, 
						"g"=>{"a"=>2.69526582406301, "b"=>0.3467887363018449, "c"=>0.021814668806581797, "d"=>0.09409816320385427, "e"=>3.1062977753686516, "f"=>0.3051461080941298, "g"=>2.944088251932868, "h"=>4.274792425944702, "i"=>2.7865943745007526, "j"=>0.16019223067681218, "k"=>0.04508227515215268, "l"=>2.7365241468589305, "m"=>0.7051584360753667, "n"=>1.0835294227066843, "o"=>1.838008035852264, "p"=>0.052014477362866, "q"=>0.0, "r"=>3.2423623053997352, "s"=>1.1883334560028906, "t"=>0.07621588148430429, "u"=>3.2359305249615, "v"=>0.013018290698431297, "w"=>0.6416288818547352, "x"=>0.0, "y"=>2.5510005070796113, "z"=>0.053748992206396125}, 
						"h"=>{"a"=>4.579343307696192, "b"=>0.5617977528089888, "c"=>0.07167676893591163, "d"=>0.10350797952423968, "e"=>4.5792448864453466, "f"=>0.5223687613136798, "g"=>0.054214595511974356, "h"=>0.12331131997917409, "i"=>4.069615376458862, "j"=>0.32038446135362436, "k"=>0.21038395071004581, "l"=>0.7539525573255661, "m"=>0.8084619012329044, "n"=>0.4343418372566709, "o"=>5.838548910523876, "p"=>0.16904705142931448, "q"=>0.2366863905325444, "r"=>1.2542656738188922, "s"=>0.525248740406683, "t"=>1.08702900966989, "u"=>2.245657810093764, "v"=>0.013018290698431297, "w"=>1.385918384806228, "x"=>0.0, "y"=>9.310761789600967, "z"=>0.08062348830959419}, 
						"i"=>{"a"=>4.958851545801847, "b"=>6.8837564155916215, "c"=>20.172335883571996, "d"=>9.25925925925926, "e"=>5.73415046959523, "f"=>13.100594776312388, "g"=>7.771544408825193, "h"=>0.33431068972131645, "i"=>0.03887942430176088, "j"=>1.8822587104525432, "k"=>6.514388759486062, "l"=>9.174487875627795, "m"=>9.158076758966068, "n"=>30.593662515462384, "o"=>10.263096893834028, "p"=>5.697752541123946, "q"=>9.546351084812624, "r"=>3.0163603785307176, "s"=>10.40594702013342, "t"=>10.643547849283093, "u"=>1.3236125460535293, "v"=>24.832389507257695, "w"=>0.49619300196766186, "x"=>7.35357917570499, "y"=>0.10921714709209344, "z"=>60.76323568933083}, 
						"j"=>{"a"=>0.49563271007590165, "b"=>0.0, "c"=>0.0, "d"=>0.0037639265281541705, "e"=>0.2920450899919245, "f"=>0.0, "g"=>0.0, "h"=>0.0, "i"=>0.14632801509935459, "j"=>0.16019223067681218, "k"=>0.0075137125253587796, "l"=>0.0, "m"=>0.0, "n"=>0.0037202726959886163, "o"=>0.4906505949621388, "p"=>0.0, "q"=>0.0, "r"=>0.0, "s"=>0.0013382133513546064, "t"=>0.0, "u"=>1.2573344509639564, "v"=>0.0, "w"=>0.0, "x"=>0.0, "y"=>0.0, "z"=>0.0}, 
						"k"=>{"a"=>0.7463942509971557, "b"=>0.5583298654459703, "c"=>0.056094862645496055, "d"=>0.07151460403492925, "e"=>2.1383452990696594, "f"=>0.5016808895784846, "g"=>0.047143126532151615, "h"=>0.46584276436576877, "i"=>1.7856259233863272, "j"=>0.4405286343612335, "k"=>0.35314448869186266, "l"=>0.7287808503242356, "m"=>0.22681847784589818, "n"=>0.3748174741208531, "o"=>0.34094421264101377, "p"=>0.1430398127478815, "q"=>0.0, "r"=>0.14226416113667265, "s"=>1.078599961191813, "t"=>0.09526985185538037, "u"=>0.2924033606892922, "v"=>0.13018290698431295, "w"=>1.120711780306271, "x"=>0.0, "y"=>1.2950033155205367, "z"=>0.0}, 
						"l"=>{"a"=>8.727847994749155, "b"=>0.9467332501040365, "c"=>0.7603970269722797, "d"=>2.1134447455585668, "e"=>8.508578824518514, "f"=>2.3377295060770624, "g"=>0.6340750518574392, "h"=>0.37541446304770776, "i"=>10.772428126082438, "j"=>0.16019223067681218, "k"=>3.892103088135848, "l"=>9.964400014383832, "m"=>1.183498394304835, "n"=>0.48921585952250296, "o"=>7.648547365167671, "p"=>0.9275915129711102, "q"=>0.4733727810650888, "r"=>0.06392883190318834, "s"=>1.8112717710584598, "t"=>1.7872624208069356, "u"=>5.968927269537418, "v"=>2.792423354813513, "w"=>0.9667208486611343, "x"=>0.10845986984815618, "y"=>30.062019737098723, "z"=>0.2149959688255845}, 
						"m"=>{"a"=>6.236220737474545, "b"=>7.081425995283673, "c"=>0.07167676893591163, "d"=>0.026347485697079193, "e"=>4.60911313428543, "f"=>0.5482286009826739, "g"=>0.014142937959645484, "h"=>0.08768804976296823, "i"=>5.7152753723588505, "j"=>0.24028834601521826, "k"=>0.0751371252535878, "l"=>0.20856557229673847, "m"=>4.026589413640549, "n"=>0.29483161115709783, "o"=>4.729755833719673, "p"=>7.2993649899221955, "q"=>0.15779092702169625, "r"=>0.049522334572892374, "s"=>1.619907261814751, "t"=>0.02858095555661411, "u"=>3.787598198795298, "v"=>0.23432923257176333, "w"=>0.3250919668063992, "x"=>0.0, "y"=>2.8747513359597456, "z"=>0.08062348830959419}, 
						"n"=>{"a"=>5.92571399720628, "b"=>1.5640172007213207, "c"=>9.00790002648924, "d"=>11.942938873833182, "e"=>8.39629633726783, "f"=>6.821825704680632, "g"=>41.68159532340185, "h"=>1.323541501109802, "i"=>5.80717219343574, "j"=>8.41009211053264, "k"=>9.038996168006612, "l"=>0.7108010596089995, "m"=>0.990365829010308, "n"=>1.576465554925176, "o"=>5.804744243548138, "p"=>0.9492642118723045, "q"=>6.7455621301775155, "r"=>0.4339957320751659, "s"=>6.800131144908433, "t"=>12.024008002667557, "u"=>2.8051229068792765, "v"=>5.0771333723882055, "w"=>2.771836769612456, "x"=>1.0195227765726682, "y"=>2.289659476537816, "z"=>2.2977694168234346}, 
						"o"=>{"a"=>1.4498729362661773, "b"=>6.457206269940352, "c"=>5.9865683967776615, "d"=>5.463339355615778, "e"=>0.6305518988462007, "f"=>4.959917248513059, "g"=>11.003205732604187, "h"=>0.8439974789685692, "i"=>1.5792115252751604, "j"=>3.2438926712054466, "k"=>7.062889773837252, "l"=>9.476548359643761, "m"=>14.372656021918301, "n"=>18.49905598080339, "o"=>3.6914696337505797, "p"=>10.701978717409679, "q"=>5.088757396449704, "r"=>11.173139085727664, "s"=>4.066830374766648, "t"=>4.92926213499738, "u"=>15.567554923097916, "v"=>18.824448349931654, "w"=>21.481734964496535, "x"=>18.242950108459873, "y"=>2.0946288567305067, "z"=>4.447729105079279}, 
						"p"=>{"a"=>4.17879802756694, "b"=>0.3225135247607158, "c"=>0.1012823908877012, "d"=>0.08092442035531466, "e"=>4.264522052722989, "f"=>0.3723816912335144, "g"=>0.0966434093909108, "h"=>13.698517523908697, "i"=>3.1973024748520817, "j"=>0.4805766920304365, "k"=>0.21038395071004581, "l"=>4.0718232706437965, "m"=>0.1976240203013766, "n"=>0.1292794761856044, "o"=>5.07939267501159, "p"=>4.052794694523309, "q"=>0.0, "r"=>5.320499545294928, "s"=>1.3034198042193867, "t"=>1.6138712904301435, "u"=>3.3041579757890016, "v"=>0.0, "w"=>0.6587389853708615, "x"=>0.0, "y"=>2.1882435542380154, "z"=>0.0}, 
						"q"=>{"a"=>0.005890371766606641, "b"=>0.0, "c"=>0.0, "d"=>0.0, "e"=>0.0005531157007422812, "f"=>0.0, "g"=>0.0, "h"=>0.0, "i"=>0.006362087613015418, "j"=>0.0, "k"=>0.0, "l"=>0.0, "m"=>0.0, "n"=>0.0, "o"=>0.001931695255756452, "p"=>0.0, "q"=>0.0, "r"=>0.0, "s"=>0.003345533378386516, "t"=>0.0, "u"=>4.885085479249108, "v"=>0.0, "w"=>0.017110103516126275, "x"=>0.0, "y"=>0.0, "z"=>0.0}, 
						"r"=>{"a"=>12.577626685067067, "b"=>5.0735192120959915, "c"=>3.496579771569254, "d"=>4.787714543812105, "e"=>11.00755556047214, "f"=>3.6669252650633566, "g"=>3.531020177258156, "h"=>1.6003069081741705, "i"=>10.622565617864742, "j"=>2.643171806167401, "k"=>8.392816890825756, "l"=>1.4132115502175555, "m"=>5.913000516517326, "n"=>1.7485281671146495, "o"=>11.303314789058879, "p"=>3.0515160052881387, "q"=>2.642998027613412, "r"=>2.2276046496970134, "s"=>6.59739182217821, "t"=>3.5840518267994095, "u"=>5.586853544903409, "v"=>5.005532773546833, "w"=>3.037043374112413, "x"=>0.0, "y"=>9.552599758162032, "z"=>0.7256113947863477}, 
						"s"=>{"a"=>3.16397112034871, "b"=>0.8773755028436676, "c"=>6.1984823223273136, "d"=>0.2578289671785607, "e"=>7.251899952432049, "f"=>1.365399534522886, "g"=>0.2805016028663021, "h"=>15.10700682322637, "i"=>5.354050175664308, "j"=>1.8822587104525432, "k"=>7.107972048989406, "l"=>2.1132247353974134, "m"=>6.8472231579420155, "n"=>1.5188013281373525, "o"=>3.633518776077886, "p"=>8.298476409267245, "q"=>16.13412228796844, "r"=>0.15667065846696862, "s"=>7.382923059423365, "t"=>15.603296336874195, "u"=>8.210686368155324, "v"=>0.3124389767623511, "w"=>6.501839336127984, "x"=>0.0, "y"=>4.762647735694505, "z"=>0.06718624025799516}, 
						"t"=>{"a"=>7.252730608054662, "b"=>1.120127618254959, "c"=>1.575330725961014, "d"=>0.2804125263474857, "e"=>11.077801254466408, "f"=>2.0015515903801395, "g"=>0.3630020742975674, "h"=>16.52645712876442, "i"=>17.256102302368816, "j"=>1.1213456147376852, "k"=>0.16530167555789316, "l"=>1.9538039243889866, "m"=>0.828673448763727, "n"=>0.3292441335949925, "o"=>7.975969711018389, "p"=>0.4529594070349581, "q"=>0.2366863905325444, "r"=>7.702974041292624, "s"=>4.207342776658883, "t"=>2.9085885771447626, "u"=>6.226242226943994, "v"=>0.221310941873332, "w"=>4.645393104628283, "x"=>0.0, "y"=>10.192300191130007, "z"=>3.0099435635581835}, 
						"u"=>{"a"=>1.5668388899173664, "b"=>7.247884588708558, "c"=>3.326736993003724, "d"=>2.655450165612767, "e"=>0.9131940219255064, "f"=>2.668735453840186, "g"=>2.8168018102960586, "h"=>0.07946729509768997, "i"=>1.3014003661734872, "j"=>1.3215859030837005, "k"=>1.6154481929521376, "l"=>6.918623467222841, "m"=>8.021738642233151, "n"=>7.259182098047787, "o"=>0.42110956575490655, "p"=>4.971717127933942, "q"=>0.5522682445759369, "r"=>5.577115278990825, "s"=>4.401383712605301, "t"=>4.672986233506407, "u"=>0.05848067213785844, "v"=>1.2367376163509731, "w"=>0.0684404140645051, "x"=>3.297180043383948, "y"=>0.20673245699574833, "z"=>1.9484009674818596}, 
						"v"=>{"a"=>1.9715915784513371, "b"=>0.0, "c"=>0.0, "d"=>0.0037639265281541705, "e"=>4.496277531334004, "f"=>0.0, "g"=>0.011785781633037904, "h"=>0.0, "i"=>2.3412482415896734, "j"=>0.0, "k"=>0.02254113757607634, "l"=>0.009589221714792574, "m"=>0.0, "n"=>0.005580409043982924, "o"=>1.1377685056405502, "p"=>0.0, "q"=>0.0, "r"=>0.030613806826878923, "s"=>0.011374813486514155, "t"=>0.0, "u"=>0.4347063295580811, "v"=>0.16923777907960685, "w"=>0.0, "x"=>0.0, "y"=>0.2262355189764793, "z"=>0.026874496103198062}, 
						"w"=>{"a"=>2.0607886366313806, "b"=>0.5340546539048412, "c"=>0.04207114698412204, "d"=>0.2898223426678711, "e"=>1.0271358562784163, "f"=>0.38272562710111196, "g"=>0.040071657552328874, "h"=>2.07711067876031, "i"=>1.2611071446243893, "j"=>0.08009611533840609, "k"=>0.7213164024344428, "l"=>0.41473383916477874, "m"=>0.1504637427294572, "n"=>0.5654814497902697, "o"=>1.581092566836656, "p"=>0.12786892351704557, "q"=>0.0, "r"=>0.3574612150079686, "s"=>0.3760379517306444, "t"=>0.07526318296575048, "u"=>0.08187294099300181, "v"=>0.0, "w"=>0.22243134570964154, "x"=>0.0, "y"=>0.2652416429379413, "z"=>0.1209352324643913}, 
						"x"=>{"a"=>0.29367710664938823, "b"=>0.04161464835622139, "c"=>0.4331769948735529, "d"=>0.0037639265281541705, "e"=>0.37943737070920497, "f"=>0.0930954228083786, "g"=>0.009428625306430322, "h"=>0.27402515550927575, "i"=>0.6482260379039042, "j"=>0.0, "k"=>0.0, "l"=>0.03595958143047215, "m"=>0.017965820027397876, "n"=>0.0037202726959886163, "o"=>0.2685056405501468, "p"=>1.1681584707743655, "q"=>0.19723865877712032, "r"=>0.0, "s"=>0.027433373702769433, "t"=>0.5363692659457914, "u"=>0.31189691806857833, "v"=>0.013018290698431297, "w"=>0.12832577637094703, "x"=>0.0, "y"=>0.9322463626789407, "z"=>0.0}, 
						"y"=>{"a"=>0.5898786583416079, "b"=>0.7976140934942434, "c"=>1.3447185128628636, "d"=>0.8864046973803071, "e"=>0.4795513125435579, "f"=>0.39306956296870954, "g"=>0.5751461436922497, "h"=>0.2055188666319568, "i"=>0.5464326360956575, "j"=>0.4004805766920304, "k"=>0.21789766323540463, "l"=>1.3341004710705167, "m"=>2.0323833905993847, "n"=>0.6733693579739395, "o"=>0.581440271982692, "p"=>2.797945428144167, "q"=>0.0, "r"=>0.5636542080478295, "s"=>1.0143657203267917, "t"=>0.7678750059543658, "u"=>0.14425232460671747, "v"=>0.11716461628588166, "w"=>1.2490375566772178, "x"=>1.2581344902386116, "y"=>0.00780122479229239, "z"=>1.4377855415210965}, 
						"z"=>{"a"=>1.1301098975075312, "b"=>0.013871549452073797, "c"=>0.006232762516166228, "d"=>0.0037639265281541705, "e"=>1.7937542175072183, "f"=>0.0, "g"=>0.004714312653215161, "h"=>0.02192201244074206, "i"=>0.9394682708552766, "j"=>0.08009611533840609, "k"=>0.030054850101435118, "l"=>0.1977776978675968, "m"=>0.022457275034247343, "n"=>0.006510477217980078, "o"=>0.6036547674238912, "p"=>0.021672698901194165, "q"=>0.15779092702169625, "r"=>0.0, "s"=>0.002676426702709213, "t"=>0.0019053970371076072, "u"=>0.09746778689643072, "v"=>0.04556401744450954, "w"=>0.07699546582256823, "x"=>0.0, "y"=>0.7099114560986075, "z"=>4.649287825853266}}

	def initialize(word_list)
		
		# used the commented code to generate the markov_hash--now used as a constant
		# @word_list = word_list
		# @totals_hash = totals
		# @markov_hash = empty_markov
		# fill_markov
		
		@markov_hash = MARKOV
	end

	def check(text)
		letters = text.downcase.chars
		possibly_wrong?(letters) ? "**#{text}**" : text
	end

	private

	def possibly_wrong?(letter_array)
		letter_array.map.with_index do |letter, i| 
			markov_hash[letter][letter_array[i + 1]]
		end
			.reject(&:nil?)
		  .any? {|per| per < 1.2}
	end

	####################
	
	# Assembling the markov_hash

	def totals
		initial_hash = inner_hash
		File.new(word_list).each do |word|
			letters = word.strip.chars
			letters.each do |letter|
				initial_hash[letter] += 1
			end
		end
		initial_hash
	end

	def empty_markov
		Hash[('a'..'z').zip(Array.new(26) {inner_hash})]
	end

	def inner_hash
		Hash[('a'..'z').zip(Array.new(26,0))]
	end

	def fill_markov
		File.new(word_list).each do |word|
			analyze(word)
		end
		percentages
	end

	def percentages
		('a'..'z').each do |letter|
			('a'..'z').each do |inner_letter|
				@markov_hash[letter][inner_letter] /= totals_hash[inner_letter].to_f  
				@markov_hash[letter][inner_letter] *= 100
			end
		end
	end

	def analyze(word)
		letters = word.gsub(/[^a-zA-Z]/, '').chars
		letters.each.with_index do |letter, i|
			break if i == letters.length - 1
			@markov_hash[letter][(letters[i + 1])] += 1
		end
	end

end
